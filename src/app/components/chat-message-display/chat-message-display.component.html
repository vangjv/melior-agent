<!-- Chat Message Display Component Template -->
<div class="chat-messages-wrapper">
  <!-- Virtual Scrolling for large message lists (>100 messages) -->
  @if (useVirtualScrolling()) {
    <cdk-virtual-scroll-viewport
      itemSize="80"
      class="chat-messages-container virtual-scroll"
      role="log"
      aria-live="polite"
      aria-label="Chat messages"
    >
      <div class="chat-message-list">
        <article
          *cdkVirtualFor="let message of messages(); trackBy: trackByMessageId"
          class="chat-message"
          [attr.data-sender]="message.sender"
        >
          <div class="message-header">
            <span class="sender-label">
              {{ message.sender === 'user' ? 'You' : 'Agent' }}
            </span>
            <time
              class="timestamp"
              [attr.datetime]="message.timestamp.toISOString()"
            >
              {{ message.timestamp | date: 'short' }}
            </time>
          </div>
          <div class="message-text">
            {{ message.content }}
          </div>
        </article>
      </div>
    </cdk-virtual-scroll-viewport>
  } @else {
    <!-- Regular scrolling for smaller message lists -->
    <div
      #scrollContainer
      class="chat-messages-container"
      role="log"
      aria-live="polite"
      aria-label="Chat messages"
    >
      <div class="chat-message-list">
        @for (message of messages(); track trackByMessageId($index, message)) {
          <article
            class="chat-message"
            [attr.data-sender]="message.sender"
          >
            <div class="message-header">
              <span class="sender-label">
                {{ message.sender === 'user' ? 'You' : 'Agent' }}
              </span>
              <time
                class="timestamp"
                [attr.datetime]="message.timestamp.toISOString()"
              >
                {{ message.timestamp | date: 'short' }}
              </time>
            </div>
            <div class="message-text">
              {{ message.content }}
            </div>
          </article>
        } @empty {
          <div class="empty-state" aria-label="No messages yet">
            <p class="hint">Chat messages will appear here during your conversation.</p>
          </div>
        }
      </div>
    </div>
  }
</div>
