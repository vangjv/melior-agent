<!-- T043: Voice chat component template -->
<div class="voice-chat-container">
  <!-- T045 & T059: ARIA labels for connection state and disconnection announcements -->
  <div
    class="connection-status"
    role="status"
    [attr.aria-label]="
      'Connection status: ' +
      (isConnected() ? 'connected' : connectionState().status === 'disconnected' ? 'disconnected from voice agent' : connectionState().status)
    "
    aria-live="polite"
  >
    <!-- Agent connection indicator -->
    @if (isConnected()) {
      <div class="agent-indicator" [class.agent-connected]="agentConnected()">
        <mat-icon [class.connected]="agentConnected()">
          {{ agentConnected() ? 'check_circle' : 'pending' }}
        </mat-icon>
        <span class="agent-status-text">
          {{ agentConnected() ? 'Agent Connected' : 'Waiting for Agent' }}
        </span>
      </div>
    }

    <!-- T117-T118: Reconnection status display -->
    @if (connectionState().status === 'reconnecting') {
      @let reconnectState = connectionState();
      @if (reconnectState.status === 'reconnecting') {
        <div class="reconnection-status" role="alert">
          <mat-spinner diameter="24" class="reconnect-spinner"></mat-spinner>
          <div class="reconnect-message">
            <strong>Reconnecting...</strong>
            <span class="attempt-count">
              Attempt {{ reconnectState.attempt }} of {{ reconnectState.maxAttempts }}
            </span>
            @if (reconnectState.lastError) {
              <span class="last-error">
                {{ reconnectState.lastError.message }}
              </span>
            }
          </div>
        </div>
      }
    }

    <!-- Connection quality indicator -->
    @if (isConnected()) {
      <div class="quality-indicator" [attr.data-quality]="connectionQuality()">
        <span class="quality-label">Quality:</span>
        <span class="quality-value">{{ connectionQuality() }}</span>
      </div>
    }

    <!-- Error message display -->
    @if (errorMessage(); as error) {
      <div class="error-message" role="alert">
        {{ error }}
      </div>
    }

    <!-- T072-T074: Mode error message display (User Story 2) -->
    @if (modeErrorMessage(); as modeError) {
      <div class="mode-error-message" role="alert">
        {{ modeError }}
      </div>
    }
  </div>

  <!-- T054-T057: Mode toggle button (positioned prominently) -->
  @if (isConnected()) {
    <div class="mode-toggle-container">
      <app-mode-toggle-button
        [currentMode]="currentMode()"
        [isPending]="isPending()"
        (onToggle)="handleModeToggle()"
      />
    </div>
  }

  <!-- Connection button -->
  <div class="button-container">
    <app-connection-button
      [connectionState]="connectionState()"
      (onConnect)="handleConnect()"
      (onDisconnect)="handleDisconnect()"
    />
  </div>

  <!-- Feature: 005-unified-conversation - Unified conversation display -->
  @if (isConnected()) {
    <div class="conversation-container">
      <h2 class="conversation-title">Conversation</h2>
      <app-unified-conversation-display />
    </div>
  }
</div>
